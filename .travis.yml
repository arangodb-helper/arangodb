sudo: required

services:
  - docker

language: go

go:
  - "1.17.x"

env:
  - VERBOSE=1 GOIMAGE=gcr.io/gcr-for-testing/golang:1.17.13 ALPINE_IMAGE=gcr.io/gcr-for-testing/alpine:3.11 ARANGODB=gcr.io/gcr-for-testing/arangodb/arangodb:3.9.2 STARTER_MODES="single,cluster,activefailover"

install:
  - make init
  - docker buildx create --use --name=arangodb_starter_buildx || echo "buildx already exists?"

script:
  - |
    set -e
    make license-verify fmt-verify linter
    make run-unit-tests
    if [ "$TRAVIS_PULL_REQUEST" != "false" ] || [ ! -z "$ALWAYS" ]; then
      make run-tests
    fi
    make binaries
